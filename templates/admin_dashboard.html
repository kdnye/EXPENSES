{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
<div class="admin-dashboard">
  <h1>Admin Dashboard</h1>
  <section class="dashboard-actions" aria-label="Admin quick actions">
    <div class="btn-toolbar flex-wrap gap-2" role="toolbar">
      <div class="btn-group me-2 mb-2" role="group" aria-label="Account tools">
        <a class="btn btn-success" href="{{ url_for('admin.create_user') }}">Add User</a>
        {% if settings_url %}
        <a class="btn btn-warning" href="{{ settings_url }}">Settings</a>
        {% endif %}
      </div>
      <div class="btn-group mb-2" role="group" aria-label="Zone tools">
        <a class="btn btn-secondary" href="{{ url_for('admin.list_cost_zones') }}">Cost Zones</a>
      </div>
    </div>
  </section>
  <section class="dashboard-table mt-4" aria-label="Pending report reviews">
    <h2 class="h4">Pending Report Reviews</h2>
    <div class="table-responsive">
      <table class="table table-striped align-middle mb-0">
        <thead>
          <tr>
            <th>Report</th>
            <th>Employee</th>
            <th>Report Month</th>
            <th>Submitted</th>
            <th>Review</th>
          </tr>
        </thead>
        <tbody>
          {% for report in pending_reports %}
          <tr>
            <td>#{{ report.id }}</td>
            <td>{{ report.employee.first_name or report.employee.email }}</td>
            <td>{{ report.report_month.strftime('%Y-%m') }}</td>
            <td>{{ report.created_at.strftime('%Y-%m-%d') }}</td>
            <td>
              <a class="btn btn-sm btn-primary" href="{{ url_for('admin.review_report', report_id=report.id) }}">Review</a>
            </td>
          </tr>
          {% endfor %}
          {% if not pending_reports %}
          <tr>
            <td colspan="5" class="text-muted">No reports pending review.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>
  <div class="dashboard-table">
    <div class="table-responsive">
      <table class="table table-striped align-middle mb-0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Email</th>
            <th>Active</th>
            <th>Toggle</th>
            <th>Edit</th>
            <th>Delete</th>
            <th>Employee Access</th>
            <th>Admin Role</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u.id }}</td>
            <td>{{ u.email }}</td>
            <td>{{ 'Yes' if u.is_active else 'No' }}</td>
            <td>
              <form method="post" action="{{ url_for('admin.toggle_active', user_id=u.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn btn-sm btn-secondary" type="submit">Toggle</button>
              </form>
            </td>
            <td>
              <a class="btn btn-sm btn-info" href="{{ url_for('admin.edit_user', user_id=u.id) }}">Edit</a>
            </td>
            <td>
              <form method="post" action="{{ url_for('admin.delete_user', user_id=u.id) }}" onsubmit="return confirm('Delete this user?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn btn-sm btn-danger" type="submit">Delete</button>
              </form>
            </td>
            <td>
              {% if u.role == 'employee' %}
              {% if u.employee_approved %}
              <span class="badge bg-success">Approved</span>
              {% else %}
              <span class="badge bg-warning text-dark me-2">Pending</span>
              <form
                method="post"
                action="{{ url_for('admin.approve_employee', user_id=u.id) }}"
                class="d-inline"
              >
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn btn-sm btn-success" type="submit">Approve</button>
              </form>
              {% endif %}
              {% elif u.role == 'super_admin' %}
              <span class="badge bg-primary">Super Admin</span>
              {% else %}
              <span class="badge bg-secondary">Customer</span>
              {% endif %}
            </td>
            <td>
              {% if not u.is_admin %}
              <form method="post" action="{{ url_for('admin.promote', user_id=u.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn btn-sm btn-primary" type="submit">Promote</button>
              </form>
              {% else %}
              <form method="post" action="{{ url_for('admin.demote', user_id=u.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn btn-sm btn-warning" type="submit">Demote</button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
